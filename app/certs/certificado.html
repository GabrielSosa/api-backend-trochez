<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Certificado de Avalúo - Trochez</title>
    <style>
        @page {
            /* Change page size from A4 to letter */
            size: letter;
            margin: 0;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
        }
        .page-container {
            /* Adjust dimensions to Letter size (approx 8.5in x 11in) */
            width: 21.59cm;
            height: 27.94cm;
            padding: 1cm;
            margin: 0 auto;
            background: white;
            position: relative;
            box-sizing: border-box;
        }
        .header-logo {
            position: absolute;
            top: 1cm;
            left: 1cm;
            padding: 0;
            max-width: 200px;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
        }
        .watermark img {
            /* Increase max-width to make the watermark larger */
            max-width: 450px;
        }
        .header-info {
            position: absolute;
            top: 1cm;
            right: 1cm;
            text-align: right; /* Keep overall alignment right for other lines */
            font-size: 14px;
            border: 1px solid #000;
            /* Increase padding to make the box larger */
            padding: 10px 15px; /* Increased from 5px 10px */
        }
        .main-title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            margin-top: 3cm;
            margin-bottom: 1cm;
        }
        .info-section {
            background: #e0e0e0;
            padding: 10px;
            margin-bottom: 15px;
        }
        .vehicle-info {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }
        .vehicle-info td {
            padding: 5px;
        }
        .label-cell {
            font-weight: bold;
            width: 100px;
            background-color: #e0e0e0;
        }
        .small-label {
            font-size: 10px;
            color: #666;
            display: block;
        }
        .diagnosis-header {
            background-color: #e0e0e0;
            padding: 5px;
            font-weight: bold;
        }
        .diagnosis-content {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .diagnosis-content td {
            padding: 5px;
            border-bottom: 1px dotted #ccc;
        }
        .diagnosis-content td:last-child {
            text-align: right;
            width: 150px;
        }
        .amount-container {
            text-align: left;
            width: 100%;
            padding-left: 500px;
            margin-left: 0;
            margin-right: auto;
            box-sizing: border-box;
        }
        
        .total-amount {
            text-align: left;
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .amount-text {
            text-align: left;
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        .values-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-top: 20px;
            width: 100%;
        }
        .value-boxes {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            margin: 10px 0;
            width: 100%;
            padding-left: 50px;
            box-sizing: border-box;
        }
        .value-box {
            border: 2px solid #000;
            padding: 5px;
            width: 300px;
            text-align: center;
            font-size: 11px;
            white-space: nowrap;
        }
        .expenses-row {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        .notes-section {
            text-align: left;
            font-size: 12px;
            margin: 15px 0;
        }
        .footer-note {
            font-size: 10px;
            margin: 20px 0;
            text-align: justify;
            position: absolute;
            /* Revert bottom position */
            bottom: 160px;
            left: 1cm;
            right: 1cm;
        }
        .vin-section {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            border-top: 1px solid #000;
            padding-top: 10px;
            position: absolute;
            /* Revert bottom position */
            bottom: 80px;
            left: 1cm;
            right: 1cm;
            background: white;
        }
        .vin-item {
            text-align: center;
        }
        .vin-label {
            font-weight: bold;
            font-size: 12px;
        }
        /* Adjust validity stamp for horizontal layout */
        .validity-stamp {
            position: absolute;
            /* Adjust position for horizontal layout */
            bottom: 10px; /* Position near bottom edge */
            right: 1cm;   /* Keep near right edge */
            border: 2px solid red;
            color: red;
            padding: 5px 10px;
            /* Remove rotation and vertical writing styles */
            /* transform: rotate(-90deg); */
            /* transform-origin: right bottom; */
            font-weight: bold;
            /* writing-mode: vertical-rl; */
            /* text-orientation: mixed; */
            white-space: nowrap;
            z-index: 1;
            text-align: right; /* Align text if needed */
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="header-logo">
            <!-- Increase max-height from 100px to 120px -->
            <img src="{{ static_url('images/AvaluoTrochez.png') }}" alt="Logo Avalúo Trochez" style="max-height: 130px; max-width: 100%;">
        </div>
        <!-- Add watermark -->
        <div class="watermark">
            <img src="{{ static_url('images/AvaluoTrochez.png') }}" alt="Watermark">
        </div>
        <div class="header-info">
            {{ formatted_date }}<br>
            SAN JOSE C.R<br>
            Tel. 8794-4104<br>
            <!-- Wrap the ID in a div and center it -->
            <div style="text-align: center; margin-top: 5px;">{{ appraisal.vehicle_appraisal_id }}</div>
        </div>
        <div class="main-title">Certificado de Avalúo</div>
        
        <div class="info-section" style="padding: 0; background: #e0e0e0; border-top: 2px solid #e0e0e0;">
            <table class="vehicle-info" style="margin-bottom: 0;">
                <tr>
                    <td class="label-cell" style="width: 100px; border-bottom: 2px solid white;">Vehículo</td>
                    <td style="background-color: white; padding: 5px 10px; width: 30%;">
                        <div>{{ appraisal.brand }} {{ appraisal.vehicle_description }}</div>
                    </td>
                    <td style="padding: 5px 10px; background-color: #e0e0e0;" colspan="5">
                        <table style="width: 100%;">
                            <tr>
                                <td style="text-align: center;"><span class="small-label">AÑO</span>{{ appraisal.model_year }}</td>
                                <td style="text-align: center;"><span class="small-label">ORIGEN</span>MEX/AGE</td>
                                <td style="text-align: center;"><span class="small-label">KM</span>{{ appraisal.mileage }}</td>
                                <td style="text-align: center;"><span class="small-label">COMB</span>{{ appraisal.fuel_type }}</td>
                                <td style="text-align: center;"><span class="small-label">CILINDRADA</span>{{ appraisal.engine_size }}</td>
                            </tr>           
                        </table>
                    </td>
                </tr>
                <tr>
                    <td class="label-cell" style="width: 100px; border-bottom: 2px solid white;">Solicitante</td>
                    <td style="background-color: white; padding: 5px 10px;" colspan="1">{{ appraisal.applicant }}</td>
                    <td style="padding: 5px 10px; background-color: #e0e0e0;" colspan="5">
                        <table style="width: 100%;">
                            <tr>
                                <td style="text-align: left;"><span class="small-label">COLOR</span>{{ appraisal.color }}</td>
                                <td colspan="3"></td>
                                <td style="text-align: right;"><span class="small-label">PLACAS</span>{{ appraisal.plate_number }}</td>
                            </tr>         
                        </table>
                    </td>
                </tr>
                <tr>
                    <td class="label-cell" style="width: 100px; border-bottom: 2px solid white;">Propietario</td>
                    <td style="background-color: white; padding: 5px 10px;" colspan="1">{{ appraisal.owner }}</td>
                    <td style="padding: 5px 10px; background-color: #e0e0e0;" colspan="5">
                        <table style="width: 100%;">
                            <tr>
                                <td colspan="6">
                                    PAQUETE ELÉCTRICO, RADIO CD, AROS 16, HALÓGENOS, TRANSMISIÓN AUTOMÁTICA TIPTRONIC
                                </td>
                            </tr>       
                        </table>
                    </td>
                </tr>
            </table>
        </div>

        <div class="diagnosis-header">Diagnostico</div>
        <table class="diagnosis-content">
            {% for deduction in deductions %}
            <tr>
                <td>{{ deduction.description }}</td>
                <td>{{ deduction.amount }}</td>
            </tr>
            {% endfor %}
        </table>
        
        <div class="notes-section">
            <div>10:00 AVALÚO SE HIZO {{ formatted_date }} NUMERO OP SALES FORCE {{ formatted_date }} 2:10PM</div>
            <div style="font-weight: bold;">NOTA: {{ appraisal.notes }}</div>
        </div>
        
        <div class="amount-container">
            <div class="total-amount">{{ appraisal_value }}</div>
            <div class="amount-text">{{ appraisal_value_words }} DÓLARES</div>
        </div>
        
        <div class="values-section">  
            <div class="value-boxes">
                <div class="value-box">VALOR MAXIMO DE GARANTIA BANCARIA</div>
                <div class="value-box">VALOR SUGERIDO PARA ENTREGA EN DISTRIBUIDORA</div>
            </div>
        </div>
        
        <div class="expenses-row">
            <table style="width: auto; margin-left: auto;">
                <tr>
                    <td style="text-align: right; padding-right: 20px;"><strong>TOTAL DE GASTOS</strong></td>
                    <td><strong>{{ total_deductions }}</strong></td>
                </tr>
            </table>
        </div>

        <div class="footer-note">
            Nota: Los gastos de reparación y la depreciación por kilometraje están rebajados. Condiciones de Servicio: En lo sucesivo "la empresa" se refiere a Avalúos Trochez. El valor emitido en este documento se ha determinado en base a la experiencia de ventas pasada de autolotes y personas particulares y no podemos anticipar todos los factores presentes o futuros que afecten el mercado de Vehículos y por lo tanto modifiquen el valor de los mismos incluyendo pero limitándose a el valor de los combustibles, la tasa de impuestos de nuevos modelos o promociones especiales, la suspensión de producción o distribución de determinado modelo, publicidad positiva o negativa, percepciones, informes de desperfectos, cambios políticos o demográficos, desastres naturales y otras situaciones que tengan influencia sobre los valores de Vehículos.
        </div>

        <div class="vin-section">
            <div class="vin-item">
                <div class="vin-label">VIN</div>
                <div>{{ appraisal.vin }}</div>
            </div>
            <div class="vin-item">
                <div class="vin-label"># Motor</div>
                <div>{{ appraisal.engine_number }}</div>
            </div>
            <div class="vin-item">
                <div class="vin-label">VIN en tarjeta</div>
                <div>IDEM</div>
            </div>
            <div class="vin-item">
                <div class="vin-label"># Motor en tarjeta</div>
                <div>IDEM</div>
            </div>
        </div>

        <!-- Restore validity stamp here, remove inline styles -->
        <div class="validity-stamp">
            VALIDO POR {{ appraisal.validity_days }} DIAS O {{ appraisal.validity_kms }} KMS
        </div>
    </div>
</body>
</html>